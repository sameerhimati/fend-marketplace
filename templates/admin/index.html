{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-header h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: bold;
    }
    
    .dashboard-header p {
        margin: 0.5rem 0 1.5rem 0;
        opacity: 0.9;
    }
    
    .dashboard-btn {
        display: inline-block;
        background-color: white;
        color: #5a67d8;
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        border-radius: 0.375rem;
        font-weight: 600;
        transition: all 0.2s;
        margin-right: 0.75rem;
        margin-bottom: 0.75rem;
    }
    
    .dashboard-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        border: 1px solid #e5e7eb;
        transition: all 0.2s;
    }
    
    .stat-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .stat-card h3 {
        margin: 0 0 0.5rem 0;
        color: #6b7280;
        font-size: 0.875rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #111827;
        margin: 0;
    }
    
    .stat-label {
        color: #6b7280;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .quick-actions {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid #e5e7eb;
    }
    
    .quick-actions h2 {
        margin: 0 0 1rem 0;
        font-size: 1.25rem;
        color: #111827;
    }
    
    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .action-btn {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        text-decoration: none;
        color: #111827;
        transition: all 0.2s;
        font-weight: 500;
    }
    
    .action-btn:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
        transform: translateX(2px);
    }
    
    .action-btn svg {
        width: 1.25rem;
        height: 1.25rem;
        margin-right: 0.75rem;
        color: #6b7280;
    }
    
    .model-groups {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    
    .model-group {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 1px solid #e5e7eb;
    }
    
    .model-group-header {
        background: #f9fafb;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .model-group-header h3 {
        margin: 0;
        font-size: 1.125rem;
        color: #111827;
        font-weight: 600;
    }
    
    .model-list {
        padding: 0.5rem 0;
    }
    
    .model-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1.5rem;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .model-item:last-child {
        border-bottom: none;
    }
    
    .model-item:hover {
        background: #f9fafb;
    }
    
    .model-name {
        font-weight: 500;
        color: #111827;
    }
    
    .model-actions {
        display: flex;
        gap: 0.75rem;
    }
    
    .model-actions a {
        color: #6366f1;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        transition: color 0.2s;
    }
    
    .model-actions a:hover {
        color: #4f46e5;
    }
    
    .recent-activity {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid #e5e7eb;
    }
    
    .recent-activity h2 {
        margin: 0 0 1rem 0;
        font-size: 1.25rem;
        color: #111827;
    }
    
    .activity-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .activity-item {
        display: flex;
        align-items: start;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-icon {
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    .activity-icon.add {
        background: #d1fae5;
        color: #059669;
    }
    
    .activity-icon.change {
        background: #dbeafe;
        color: #2563eb;
    }
    
    .activity-icon.delete {
        background: #fee2e2;
        color: #dc2626;
    }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-action {
        font-weight: 500;
        color: #111827;
        margin-bottom: 0.25rem;
    }
    
    .activity-time {
        font-size: 0.875rem;
        color: #6b7280;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <!-- Enhanced Dashboard Header -->
    <div class="dashboard-header">
        <h1>Fend Admin Dashboard</h1>
        <p>Manage your marketplace, monitor transactions, and oversee operations</p>
        
        <div class="dashboard-actions">
            <a href="{% url 'payments:admin_payment_dashboard' %}" class="dashboard-btn">
                <svg style="display: inline; width: 1rem; height: 1rem; margin-right: 0.5rem; vertical-align: middle;" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z" />
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd" />
                </svg>
                Payment Dashboard
            </a>
            <a href="{% url 'payments:admin_escrow_payments' %}" class="dashboard-btn">
                <svg style="display: inline; width: 1rem; height: 1rem; margin-right: 0.5rem; vertical-align: middle;" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 00-1 1v2.101a7.002 7.002 0 0011.601 2.566 1 1 0 11.798-1.27A5.002 5.002 0 005.999 7H9a1 1 0 100-2H4zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                </svg>
                All Escrow Payments
            </a>
            <a href="{% url 'admin:payments_escrowpaymentlog_changelist' %}" class="dashboard-btn">
                <svg style="display: inline; width: 1rem; height: 1rem; margin-right: 0.5rem; vertical-align: middle;" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                Audit Logs
            </a>
        </div>
    </div>
    
    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Pending Payments</h3>
            <p class="stat-value">{{ payment_stats.pending_count }}</p>
            <p class="stat-label">Awaiting verification</p>
        </div>
        
        <div class="stat-card">
            <h3>Ready for Release</h3>
            <p class="stat-value">{{ payment_stats.ready_count }}</p>
            <p class="stat-label">Completed pilots</p>
        </div>
        
        <div class="stat-card">
            <h3>Total Escrow Value</h3>
            <p class="stat-value">${{ payment_stats.total_escrow }}</p>
            <p class="stat-label">In active escrow</p>
        </div>
        
        <div class="stat-card">
            <h3>Released This Month</h3>
            <p class="stat-value">${{ payment_stats.released_month }}</p>
            <p class="stat-label">{{ payment_stats.released_count_month }} payments</p>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-grid">
            {% if perms.organizations.add_organization %}
            <a href="{% url 'admin:organizations_organization_add' %}" class="action-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add Organization
            </a>
            {% endif %}
            
            {% if perms.pilots.add_pilot %}
            <a href="{% url 'admin:pilots_pilot_add' %}" class="action-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
                Create Pilot
            </a>
            {% endif %}
            
            {% if perms.payments.change_subscription %}
            <a href="{% url 'admin:payments_subscription_changelist' %}" class="action-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
                Manage Subscriptions
            </a>
            {% endif %}
            
            {% if perms.users.change_user %}
            <a href="{% url 'admin:users_user_changelist' %}" class="action-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                Manage Users
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Model Groups -->
    <div class="model-groups">
        <!-- Organizations -->
        <div class="model-group">
            <div class="model-group-header">
                <h3>Organizations</h3>
            </div>
            <div class="model-list">
                <div class="model-item">
                    <span class="model-name">Organizations</span>
                    <div class="model-actions">
                        {% if perms.organizations.add_organization %}
                        <a href="{% url 'admin:organizations_organization_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:organizations_organization_changelist' %}">Change</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Payments -->
        <div class="model-group">
            <div class="model-group-header">
                <h3>Payments</h3>
            </div>
            <div class="model-list">
                <div class="model-item">
                    <span class="model-name">Escrow Payments</span>
                    <div class="model-actions">
                        {% if perms.payments.add_escrowpayment %}
                        <a href="{% url 'admin:payments_escrowpayment_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:payments_escrowpayment_changelist' %}">Change</a>
                    </div>
                </div>
                <div class="model-item">
                    <span class="model-name">Payment Logs</span>
                    <div class="model-actions">
                        {% if perms.payments.add_escrowpaymentlog %}
                        <a href="{% url 'admin:payments_escrowpaymentlog_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:payments_escrowpaymentlog_changelist' %}">Change</a>
                    </div>
                </div>
                <div class="model-item">
                    <span class="model-name">Subscriptions</span>
                    <div class="model-actions">
                        {% if perms.payments.add_subscription %}
                        <a href="{% url 'admin:payments_subscription_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:payments_subscription_changelist' %}">Change</a>
                    </div>
                </div>
                <div class="model-item">
                    <span class="model-name">Pricing Plans</span>
                    <div class="model-actions">
                        {% if perms.payments.add_pricingplan %}
                        <a href="{% url 'admin:payments_pricingplan_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:payments_pricingplan_changelist' %}">Change</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pilots -->
        <div class="model-group">
            <div class="model-group-header">
                <h3>Pilots</h3>
            </div>
            <div class="model-list">
                <div class="model-item">
                    <span class="model-name">Pilots</span>
                    <div class="model-actions">
                        {% if perms.pilots.add_pilot %}
                        <a href="{% url 'admin:pilots_pilot_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:pilots_pilot_changelist' %}">Change</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Authentication and Authorization -->
        <div class="model-group">
            <div class="model-group-header">
                <h3>Authentication and Authorization</h3>
            </div>
            <div class="model-list">
                <div class="model-item">
                    <span class="model-name">Users</span>
                    <div class="model-actions">
                        {% if perms.users.add_user %}
                        <a href="{% url 'admin:users_user_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:users_user_changelist' %}">Change</a>
                    </div>
                </div>
                <div class="model-item">
                    <span class="model-name">Groups</span>
                    <div class="model-actions">
                        {% if perms.auth.add_group %}
                        <a href="{% url 'admin:auth_group_add' %}">Add</a>
                        {% endif %}
                        <a href="{% url 'admin:auth_group_changelist' %}">Change</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="recent-activity">
        <h2>Recent Activity</h2>
        {% load log %}
        {% get_admin_log 10 as admin_log for_user user %}
        {% if admin_log %}
        <ul class="activity-list">
            {% for entry in admin_log %}
            <li class="activity-item">
                <div class="activity-icon {% if entry.is_addition %}add{% endif %}{% if entry.is_change %}change{% endif %}{% if entry.is_deletion %}delete{% endif %}">
                    {% if entry.is_addition %}
                        <svg fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    {% elif entry.is_change %}
                        <svg fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    {% elif entry.is_deletion %}
                        <svg fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    {% endif %}
                </div>
                <div class="activity-content">
                    <div class="activity-action">
                        {% if entry.is_addition %}
                            Added
                        {% elif entry.is_change %}
                            Changed
                        {% elif entry.is_deletion %}
                            Deleted
                        {% endif %}
                        
                        {% if entry.is_deletion or not entry.get_admin_url %}
                            "{{ entry.object_repr }}"
                        {% else %}
                            <a href="{{ entry.get_admin_url }}">"{{ entry.object_repr }}"</a>
                        {% endif %}
                        
                        {% if entry.content_type %}
                            in {{ entry.content_type|capfirst }}
                        {% endif %}
                    </div>
                    <div class="activity-time">
                        {{ entry.action_time|timesince }} ago
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p style="color: #6b7280;">No recent activity</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block sidebar %}{% endblock %}