{% extends 'admin/base_admin.html' %}

{% block title %}Operations Dashboard - Fend{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Simple Header -->
    <div>
        <h1 class="text-2xl font-bold text-gray-900">Operations Dashboard</h1>
        <p class="text-gray-600">Process pending items efficiently</p>
    </div>

    <!-- SLA Alert Banner -->
    {% if overdue_items > 0 %}
    <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <i class="fas fa-exclamation-triangle text-red-400"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-red-800">
                    <strong>{{ overdue_items }} item{{ overdue_items|pluralize }}</strong> overdue (>24hrs) - immediate attention required
                </p>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Manual Tasks for Operations -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- STEP 1: Generate Mercury Invoices -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 {% if invoices_to_generate > 0 %}bg-yellow-50{% else %}bg-gray-50{% endif %}">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">ðŸ“„ Generate Invoices</h2>
                    {% if invoices_to_generate > 0 %}
                    <span class="bg-yellow-500 text-white text-sm font-bold px-3 py-1 rounded-full">
                        {{ invoices_to_generate }}
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <div class="p-6">
                {% if invoices_to_generate > 0 %}
                    <div class="space-y-3">
                        <div class="text-2xl font-bold text-yellow-600">{{ invoices_to_generate }}</div>
                        <p class="text-sm text-gray-600">Approved bids need Mercury invoices</p>
                        <a href="{% url 'payments:admin_payment_dashboard' %}" 
                           class="inline-flex items-center px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-md hover:bg-yellow-700">
                            Generate Invoices
                        </a>
                    </div>
                {% else %}
                    <div class="text-center text-gray-400">
                        <i class="fas fa-check-circle text-2xl mb-2"></i>
                        <p class="text-sm">No invoices needed</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- STEP 2: Check Mercury Account -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 {% if check_mercury_payments > 0 %}bg-blue-50{% else %}bg-gray-50{% endif %}">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">ðŸ’° Check Mercury</h2>
                    {% if check_mercury_payments > 0 %}
                    <span class="bg-blue-500 text-white text-sm font-bold px-3 py-1 rounded-full">
                        {{ check_mercury_payments }}
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <div class="p-6">
                {% if check_mercury_payments > 0 %}
                    <div class="space-y-3">
                        <div class="text-2xl font-bold text-blue-600">{{ check_mercury_payments }}</div>
                        <p class="text-sm text-gray-600">Invoices sent - check for wire transfers</p>
                        <a href="{% url 'payments:admin_payment_dashboard' %}" 
                           class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700">
                            Check Payments
                        </a>
                    </div>
                {% else %}
                    <div class="text-center text-gray-400">
                        <i class="fas fa-check-circle text-2xl mb-2"></i>
                        <p class="text-sm">No payments to verify</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Secondary Tasks -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- STEP 3: Release Funds to Startups -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 {% if release_funds > 0 %}bg-green-50{% else %}bg-gray-50{% endif %}">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">ðŸ’¸ Release Funds</h2>
                    {% if release_funds > 0 %}
                    <span class="bg-green-500 text-white text-sm font-bold px-3 py-1 rounded-full">
                        {{ release_funds }}
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <div class="p-6">
                {% if release_funds > 0 %}
                    <div class="space-y-3">
                        <div class="text-2xl font-bold text-green-600">{{ release_funds }}</div>
                        <p class="text-sm text-gray-600">Completed work - send money to startups</p>
                        <a href="{% url 'payments:admin_payment_dashboard' %}" 
                           class="inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700">
                            Release Funds
                        </a>
                    </div>
                {% else %}
                    <div class="text-center text-gray-400">
                        <i class="fas fa-check-circle text-2xl mb-2"></i>
                        <p class="text-sm">No funds to release</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Secondary: Organization Approvals -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 {% if pending_approvals_count > 0 %}bg-orange-50{% else %}bg-gray-50{% endif %}">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Organization Approvals</h2>
                    {% if pending_approvals_count > 0 %}
                    <span class="bg-orange-500 text-white text-sm font-bold px-3 py-1 rounded-full">
                        {{ pending_approvals_count }}
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <div class="p-6">
                {% if pending_approvals_count > 0 %}
                    <div class="space-y-3">
                        <div class="text-2xl font-bold text-orange-600">{{ pending_approvals_count }}</div>
                        <p class="text-sm text-gray-600">Organizations awaiting approval</p>
                        <a href="{% url 'admin:pending_approvals' %}" 
                           class="inline-flex items-center px-4 py-2 bg-orange-600 text-white text-sm font-medium rounded-md hover:bg-orange-700">
                            Review
                        </a>
                    </div>
                {% else %}
                    <div class="text-center text-gray-400">
                        <i class="fas fa-check-circle text-2xl mb-2"></i>
                        <p class="text-sm">All approved</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Current Active Work Summary -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-blue-50">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Active Work Status</h2>
                    <a href="{% url 'payments:admin_active_pilots_dashboard' %}" class="text-sm text-blue-600 hover:text-blue-700">View All</a>
                </div>
                <p class="text-sm text-gray-600 mt-1">Current work in progress</p>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div>
                        <div class="text-xl font-bold text-green-600">{{ active_pilots_count|default:0 }}</div>
                        <div class="text-sm text-gray-600">Live pilots</div>
                    </div>
                    <div>
                        <div class="text-xl font-bold text-purple-600">{{ completion_pending_count|default:0 }}</div>
                        <div class="text-sm text-gray-600">Awaiting completion</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary: Pilot Verifications -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 {% if pilot_count_pending > 0 %}bg-purple-50{% else %}bg-gray-50{% endif %}">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Pilot Verifications</h2>
                    {% if pilot_count_pending > 0 %}
                    <span class="bg-purple-500 text-white text-sm font-bold px-3 py-1 rounded-full">
                        {{ pilot_count_pending }}
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <div class="p-6">
                {% if pilot_count_pending > 0 %}
                    <div class="space-y-3">
                        <div class="text-2xl font-bold text-purple-600">{{ pilot_count_pending }}</div>
                        <p class="text-sm text-gray-600">Pilots need verification</p>
                        <a href="{% url 'pilots:admin_verify_pilots' %}" 
                           class="inline-flex items-center px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700">
                            Verify
                        </a>
                    </div>
                {% else %}
                    <div class="text-center text-gray-400">
                        <i class="fas fa-check-circle text-2xl mb-2"></i>
                        <p class="text-sm">All verified</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Current Status Overview -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Current Status</h3>
        <div class="grid grid-cols-4 gap-6 text-center">
            <div>
                <div class="text-2xl font-bold text-yellow-600">{{ invoices_to_generate|default:0 }}</div>
                <div class="text-sm text-gray-600">Invoices needed</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-blue-600">{{ check_mercury_payments|default:0 }}</div>
                <div class="text-sm text-gray-600">Check Mercury</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-green-600">{{ release_funds|default:0 }}</div>
                <div class="text-sm text-gray-600">Funds to release</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-gray-600">{{ total_queue_depth|default:0 }}</div>
                <div class="text-sm text-gray-600">Total pending</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}